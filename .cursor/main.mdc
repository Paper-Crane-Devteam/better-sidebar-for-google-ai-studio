---
alwaysApply: true
---
# Project Structure & Architecture

This document outlines the structure of the Better Sidebar for Google AI Studio Chrome Extension and provides guidelines for development.
The project is under Chrome Extension Manifest V3, using WXT

## Directory Structure

.
├── wxt.config.ts        # WXT configuration (replaces vite.config.ts/manifest.config.ts)
├── tsconfig.json        # TypeScript config extending .wxt/tsconfig.json
├── package.json         # Dependencies (wxt, @wxt-dev/module-react)
├── src/
│   ├── entrypoints/     # Extension entry points (auto-detected by WXT)
│   │   ├── background.ts       # Background service worker
│   │   ├── content/            # Content scripts
│   │   │   └── index.ts        # Main content script
│   │   ├── sidepanel/          # Side panel UI
│   │   │   ├── index.html
│   │   │   └── index.tsx
│   │   ├── options/            # Options page UI
│   │   │   ├── index.html
│   │   │   └── index.tsx
│   │   ├── offscreen.html      # Offscreen document for SQLite
│   │   ├── offscreen.ts        # Offscreen logic
│   │   └── main-world.ts       # Script injected into main world (unlisted)
│   ├── shared/          # Shared code (components, db, types, lib)
│   │   ├── workers/     # Web Workers (e.g. db-worker.ts)
│   │   └── ...
│   ├── public/          # Static assets (sqlite3.wasm, icons)
│   └── index.css        # Global styles (Tailwind)
```

## Architecture Principles

1.  **Separation of Concerns**:
    *   **Side Panel**: Pure UI. Should not contain heavy business logic or direct DOM manipulation of the host page.
    *   **Background**: The "Brain". Handles data persistence, coordination between parts, and long-running tasks.
    *   **Content Script**: The "Hands". interacts with the AI Studio page DOM. Minimal logic, mostly just reading/writing DOM and sending messages to Background.

2.  **Shared Logic**:
    *   Any code used by more than one context (e.g., types, utility functions, UI components) MUST go in `src/shared`.

3.  **Messaging**:
    *   Communication between contexts happens via Chrome Runtime Messages.
    *   Define typed messages in `src/shared/types` to ensure type safety across boundaries.

## Adding New Features

1.  **UI Components**: Add to `src/shared/components` if reusable, or local to `sidepanel`/`options` if specific.
2.  **Business Logic**: Implement in `src/background` if it involves data persistence or coordination.
3.  **DOM Interaction**: Implement in `src/content`.

## Development

*   `npm run dev`: Start the development server (HMR enabled).
*   `npm run build`: Build for production.


要求：
1. 项目结构必须有条理并且高可扩展，耦合性低，高可维护性，遵循职责分离和功能新增开关原则
2. 写代码时需要考虑可维护性，不要使用最直接了当但是对未来项目维护造成困难的方式